<?php

namespace Application\PlateformeBundle\Repository;

/**
 * SuiviAdministratifRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class SuiviAdministratifRepository extends \Doctrine\ORM\EntityRepository
{
	public function findBeforeDateAndDetailStatut($date, $detailStatut)
	{
		$queryBuilder = $this->createQueryBuilder('s')
                ->where('s.date < :date')
                ->setParameter('date', $date)
				->andWhere('s.detailStatut = :detailStatut')
                ->setParameter('detailStatut', $detailStatut)
                ;
        
        $query = $queryBuilder->getQuery();
        $results = $query->getResult();
        return $results;
	}
	
	public function findByBeneficiaireAndDate($beneficiaire, $date)
	{
		$queryBuilder = $this->createQueryBuilder('s')
                ->where('s.date > :date')
                ->setParameter('date', $date)
				->andWhere('s.beneficiaire = :beneficiaire')
                ->setParameter('beneficiaire', $beneficiaire)
                ;
        
        $query = $queryBuilder->getQuery();
        $results = $query->getResult();
        return $results;
	}
	
	public function findByBeneficiaire($beneficiaire)
	{
		$queryBuilder = $this->createQueryBuilder('s')
				->where('s.beneficiaire = :beneficiaire')
                ->setParameter('beneficiaire', $beneficiaire)
				->andWhere('s.statut != :statut')
				->setParameter('statut', "NULL")
				->orderBy('s.id', 'DESC')
				->setMaxResults(1)
                ;
        
        $query = $queryBuilder->getQuery();
        $results = $query->getResult();
        return $results;
	}

    public function getLast($beneficiaire)
    {
        $queryBuilder = $this->createQueryBuilder('s')
            ->where('s.beneficiaire = :beneficiaire')
            ->setParameter('beneficiaire', $beneficiaire)
            ->andWhere('s.detailStatut != :statut')
            ->setParameter('statut', "NULL")
            ->orderBy('s.id', 'DESC')
            ->setMaxResults(1)
        ;

        $query = $queryBuilder->getQuery();
        $results = $query->getResult();
        return $results;
    }
}
