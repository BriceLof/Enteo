<?php

namespace Application\PlateformeBundle\Repository;

//use Doctrine\ORM\QueryBuilder;
use Doctrine\ORM\Query\ResultSetMappingBuilder;

/**
 * VilleRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class VilleRepository extends \Doctrine\ORM\EntityRepository
{
    public function findByDepartement($departement)
    {
        $queryBuilder = $this->createQueryBuilder("v")
                ->where("v.cp LIKE :departement")
                ->setParameter("departement", $departement.'%')
                ->orderBy("v.nom", "ASC");
        $query = $queryBuilder->getQuery();
        $results = $query->getResult();
        return $results;
        
    }

    public function getVilles($nomVille){
        $rsm = new ResultSetMappingBuilder($this->getEntityManager());
        $rsm->addRootEntityFromClassMetadata('Application\PlateformeBundle\Entity\Ville','v');

        $query = 'SELECT v.* FROM ville v WHERE 1';
        $params = array();

        if(!is_null($nomVille)) {
            $query .= ' AND v.ville LIKE :nomVille';
            $params['nomVille'] = "%".$nomVille."%";
        }

        $request = $this->getEntityManager()->createNativeQuery($query,$rsm);
        $request->setParameters($params);

        return $request;
    }
}
